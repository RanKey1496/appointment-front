<mat-stepper
  class="stepper"
  [orientation]="(stepperOrientation | async)!"
  linear>
  <!-- Schedule form -->
  <mat-step [stepControl]="scheduleFormGroup" label="Información de la cita">
    <div fxLayout="column" fxLayoutAlign="space-between center" class="container" [formGroup]="scheduleFormGroup" fxFlexFill>
      <div fxLayout="row" fxLayoutAlign="center center" fxFlexFill>
        <button *ngIf="!addServiceClicked" mat-raised-button color="warn" (click)="addService()" fxFlexFill>Click aquí para agregar un servicio</button>
      </div>
      <div fxLayout="row" fxFlexFill *ngIf="addedServices.length > 0">
        <div fxLayout="column" fxFlexFill>
          <book-services [services]="addedServicesGrouped" (isHomeService)="isHomeService = $event" (addService)="addService()" (quantityModified)="modifyAddedServicesQuantity($event)"></book-services>
        </div>
      </div>
      <div fxLayout="row" fxLayoutAlign="center center" *ngIf="addServiceClicked" fxFlexFill>
        <mat-form-field fxFlexFill>
          <mat-label>Seleccione una fecha</mat-label>
          <input matInput
            [min]="minDate"
            [max]="maxDate"
            [matDatepicker]="picker"
            [disabled]="addedServices.length === 0"
            (dateChange)="onDateChange($event)"
            formControlName="startDate"
          >
          <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker touchUi #picker></mat-datepicker>
        </mat-form-field>
      </div>
      <div fxLayout="row" fxFlexFill *ngIf="availableHours.length > 0">
        <div fxLayout="column" fxFlexFill>
          <book-available-hour [availableHours]="availableHours" (showResult)="showResult($event)" fxFlexFill></book-available-hour>
        </div>
      </div>
      <div fxLayout="row" fxFlexFill class="mt" *ngIf="result.length > 0">
        <div fxLayout="column" fxFlexFill>
          <book-result [result]="resultTotal"></book-result>
        </div>
      </div>
      <div fxLayout="row" fxLayoutAlign="center center" class="mt" *ngIf="addServiceClicked">
        <button mat-raised-button
          matStepperNext
        >Siguiente</button>
      </div>
    </div>
  </mat-step>

  <!-- User form -->
  <mat-step [stepControl]="userFormGroup" label="Verificación de identidad" *ngIf="!user.isAuthenticated">
    <div fxLayout="column" fxLayoutAlign="space-between center" class="container" [formGroup]="userFormGroup">
      <div fxLayout="row" fxLayoutAlign="center center" fxFlexFill>
        <mat-form-field fxFlexFill>
          <mat-label>Celular</mat-label>
          <input matInput
            formControlName="phone"
            placeholder="Escriba su número"
            required
          >
        </mat-form-field>
      </div>
      <div fxLayout="row" fxLayoutAlign="center center" *ngIf="!userFormGroup.get('phoneVerified')?.value">
        <book-phone-login [phoneNumber]="userFormGroup.get('phone')" (verified)="phoneVerifiedSuccessfully($event)"></book-phone-login>
      </div>
      <div fxLayout="row" fxLayoutAlign="center center" *ngIf="userFormGroup.get('phoneVerified')?.value">
        <div fxLayout="column" fxLayoutAlign="center center" fxFlexFill>
          <div fxLayout="row" fxLayoutAlign="center center">
            <h5>¡Celular verificado exitosamente!</h5>
          </div>
          <div fxLayout="row" fxLayoutAlign="center center">
            <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
              <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
              <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
            </svg>
          </div>
        </div>
      </div>
      <div fxLayout="row" fxLayoutAlign="center center" fxFlexFill class="mt" *ngIf="userFormGroup.get('phoneVerified')?.value">
        <mat-form-field fxFlexFill>
          <mat-label>Nombre</mat-label>
          <input matInput formControlName="name" placeholder="Escriba su nombre"
                  required>
        </mat-form-field>
      </div>
      <div fxLayout="row" fxLayoutAlign="center center" fxFlexFill *ngIf="userFormGroup.get('phoneVerified')?.value">
        <mat-form-field fxFlexFill>
          <mat-label>Instagram</mat-label>
          <input matInput formControlName="instagram" placeholder="Usuario de instagram">
        </mat-form-field>
      </div>
      <div fxLayout="row" fxLayoutAlign="center center" fxFlexFill>
        <mat-checkbox fxFlexFill
          formControlName="privacyAcceptance"
          *ngIf="userFormGroup.get('phoneVerified')?.value"
        >Acepto las politicas de tratamiento de datos</mat-checkbox>
      </div>
      <div fxLayout="row" fxLayoutAlign="center center" fxFlexFill *ngIf="signUpError" class="mt">
        <h5 class="warning">Ocurrió un error, intente nuevamente</h5>
      </div>
      <div fxLayout="row" fxLayoutAlign="center center" class="mt">
        <button mat-raised-button matStepperPrevious>Atrás</button>
        <button mat-raised-button class="ml" [disabled]="!userFormGroup.valid" (click)="saveNewUser()">Siguiente</button>
      </div>
    </div>
  </mat-step>

  <mat-step label="Verificación de identidad" *ngIf="user.isAuthenticated">
    <div fxLayout="column" fxLayoutAlign="space-between center" class="container">
      <div fxLayout="row" fxLayoutAlign="center center">
        <div fxLayout="column" fxLayoutAlign="center center" fxFlexFill>
          <div fxLayout="row" fxLayoutAlign="center center">
            <h5>¡Hola {{ user.userData?.name }}!</h5>
          </div>
          <div fxLayout="row" fxLayoutAlign="center center">
            <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
              <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
              <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
            </svg>
          </div>
          <div fxLayout="row" fxLayoutAlign="center center" class="mt">
            <h5>Presiona siguiente para continuar</h5>
          </div>
        </div>
      </div>
      <div fxLayout="row" fxLayoutAlign="center center" class="mt">
        <button mat-raised-button matStepperPrevious>Atrás</button>
        <button mat-raised-button class="ml" matStepperNext>Siguiente</button>
      </div>
    </div>
  </mat-step>

  <!-- Payment form -->
  <mat-step [stepControl]="paymentFormGroup" label="Pago del servicio">
    <div fxLayout="column" fxFlexFill>
      <div fxLayout="row" class="mt" fxFlexFill>
        <h5>Para poder confirmar la cita, debes realizar el pago del anticipo (20% del total)</h5>
      </div>
      <div fxLayout="row" fxFlexFill>
        <h6 class="warning">Hasta que no se realice el pago no se garantizará que la cita está confirmada y los horarios podrán ser tomados por otro usuario en cualquier momento</h6>
      </div>
      <div fxLayout="row" fxFlexFill>
        <mat-accordion class="mt">
          <mat-expansion-panel>
            <mat-expansion-panel-header [collapsedHeight]="'100px'" [expandedHeight]="'100px'">
              <mat-panel-title>
                Transferencia
              </mat-panel-title>
              <mat-panel-description>
                Paga y envía el comprobante (Sin recargo)
              </mat-panel-description>
            </mat-expansion-panel-header>
            <div fxLayout="column" fxFlexFill>
              <div fxLayout="row" fxFlexFill>
                <h3>Bancolombia</h3>
              </div>
              <div fxLayout="row" fxFlexFill>
                <h5>Cuenta de ahorros: 584-177304-92</h5>
              </div>
              <div fxLayout="row" fxFlexFill>
                <h3>Nequi</h3>
              </div>
              <div fxLayout="row" fxFlexFill>
                <h5>3122818064</h5>
              </div>
              <div fxLayout="row" class="mt" fxFlexFill>
                <button mat-raised-button (click)="sendToWhatsapp()">Enviar a Whatsapp</button>
              </div>
              <div fxLayout="row" class="mt" fxFlexFill>
                <h6>Envía el comprobante de pago a Whatsapp para verificar la transacción (Esto puede tardar un momento)</h6>
              </div>
            </div>
          </mat-expansion-panel>
          <mat-expansion-panel disabled>
            <mat-expansion-panel-header [collapsedHeight]="'100px'" [expandedHeight]="'100px'">
              <mat-panel-title>
                Wompi
              </mat-panel-title>
              <mat-panel-description>
                PSE, Bancolombia, Nequi, etc (Recargo del 4%)
              </mat-panel-description>
            </mat-expansion-panel-header>
            <p class="warning">Estamos trabajando para habilitar este tipo de pago, utiliza otro disponible</p>
          </mat-expansion-panel>
        </mat-accordion>
      </div>
    </div>
  </mat-step>
</mat-stepper>
